---
layout: '[default_layout]'   
title: SQL学习笔记2(中级)           
date: 2018-03-22 13:47:41  
updated: 
permalink: 
render_drafts: true
copyright: true
password: 
comments: true
toc: true                  
tags:                        
- SQL

categories:                  
- 2018
---
# 1、SQL SELECT TOP 子句
SELECT TOP 子句用于规定要返回的记录的数目(前几条)。

>SELECT column_name(s) FROM table_name LIMIT number;
<!--more-->

# 2、SQL LIKE 操作符
LIKE 操作符用于在 WHERE 子句中搜索列中的指定模式。

>SELECT column_name(s) FROM table_name WHERE column_name LIKE pattern;

## SQL 通配符
在 SQL 中，通配符与 SQL LIKE 操作符一起用于搜索表中的数据。

|通配符 |描述|
|:---:|:---:|
|%  | 替代 0 个或多个字符|
|_   |替代一个字符|
|[charlist] | 字符列中的任何单一字符|
|[^charlist]或[!charlist] |不在字符列中的任何单一字符|

LIKE'[CK]ars[eo]n' 将搜索下列字符串：Carsen、Karsen、Carson 和 Karson（如 Carson）。

LIKE'[M-Z]inger' 将搜索以字符串 inger 结尾、以从 M 到 Z 的任何单个字母开头的所有名称（如 Ringer）。

LIKE'M[^c]%' 将搜索以字母 M 开头，并且第二个字母不是 c 的所有名称（如MacFeather）。

MySQL 中使用 REGEXP 或 NOT REGEXP 运算符 (或 RLIKE 和 NOT RLIKE) 来操作正则表达式。

# 3、IN 与 = 的异同

 相同点：均在WHERE中使用作为筛选条件之一、均是等于的含义
 不同点：IN可以规定多个值，=规定一个值

# 4、SQL BETWEEN 操作符
BETWEEN 操作符选取介于两个值之间的数据范围内的值。这些值可以是数值、文本或者日期。

选取alexa介于 1 和 20 之间但 country 不为 USA 和 IND 的所有网站
>SELECT * FROM Websites  WHERE (alexa BETWEEN 1 AND 20)  AND NOT country IN ('USA', 'IND');

```
    
请注意，在不同的数据库中，BETWEEN 操作符会产生不同的结果！
在某些数据库中，BETWEEN 选取介于两个值之间但不包括两个测试值的字段。
在某些数据库中，BETWEEN 选取介于两个值之间且包括两个测试值的字段。
在某些数据库中，BETWEEN 选取介于两个值之间且包括第一个测试值但不包括最后一个测试值的字段。

因此，请检查您的数据库是如何处理 BETWEEN 操作符！
```

# 5、SQL 别名（AS语句）
通过使用 SQL，可以为表名称或列名称指定别名。基本上，创建别名是为了让列名称的可读性更强。

## 在下面的情况下，使用别名很有用
- 在查询中涉及超过一个表
- 在查询中使用了函数
- 列名称很长或者可读性差
- 需要把两个列或者多个列结合在一起

>SELECT w.name, w.url, a.count, a.date  FROM Websites AS  w, access_log  AS  a  WHERE a.site_id=w.id and w.name="菜鸟教程";
SELECT name, CONCAT(url, ', ', alexa, ', ', country) AS site_info   FROM Websites; 将三列合并到一列

# 6、SQL JOIN
SQL JOIN 子句用于把来自两个或多个表的行结合起来，基于这些表之间的共同字段。

INNER JOIN：如果表中有至少一个匹配，则返回行。`注释：INNER JOIN 与 JOIN 是相同的。`
LEFT JOIN：即使右表中没有匹配，也从左表返回所有的行。`注释：在某些数据库中，LEFT JOIN 称为 LEFT OUTER JOIN。`
RIGHT JOIN：即使左表中没有匹配，也从右表返回所有的行。`注释：在某些数据库中，RIGHT JOIN 称为 RIGHT OUTER JOIN。`
FULL OUTER JOIN：只要其中一个表中存在匹配，则返回行

MySQL中不支持 FULL OUTER JOIN。
注释：FULL OUTER JOIN 关键字返回左表（Websites）和右表（access_log）中所有的行。如果 "Websites" 表中的行在 "access_log" 中没有匹配或者 "access_log" 表中的行在 "Websites" 表中没有匹配，也会列出这些行。

>SELECT Websites.id, Websites.name, access_log.count, access_log.date FROM Websites INNER JOIN access_log ON Websites.id=access_log.site_id;

# 7、SQL UNION 操作符
UNION 操作符用于合并两个或多个 SELECT 语句的结果集。

请注意，UNION 内部的每个 SELECT 语句必须拥有相同数量的列。列也必须拥有相似的数据类型。同时，每个 SELECT 语句中的列的顺序必须相同。

>SELECT column_name(s) FROM table1 UNION SELECT column_name(s) FROM table2;
注释：默认地，UNION 操作符选取不同的值。如果允许重复的值，请使用 UNION ALL。

>SELECT column_name(s) FROM table1 UNION ALL SELECT column_name(s) FROM table2;
注释：UNION 结果集中的列名总是等于 UNION 中第一个 SELECT 语句中的列名。

使用UNION命令时需要注意，只能在最后使用一个ORDER BY命令，是将两个查询结果合在一起之后，再进行排序！绝对不能写两个ORDER BY命令。

另外，在使用ORDER BY排序时，注意两个结果的别名保持一致，使用别名排序很方便。当然也可以使用列数。

# 8、SQL SELECT INTO 语句
SELECT INTO 语句从一个表复制数据，然后把数据插入到另一个新表中。

>MySQL 数据库不支持 SELECT ... INTO 语句，但支持 INSERT INTO ... SELECT 。

当然你可以使用以下语句来拷贝表结构及数据：CREATE TABLE 新表 SELECT * FROM 旧表 SQL SELECT INTO 语法

>SELECT  * INTO newtable [IN externaldb]  FROM table1;
INSERT INTO table2  SELECT * FROM table1;

# 9、创建表

CREATE DATABASE dbname;

CREATE TABLE table_name
(
column_name1 data_type(size),
column_name2 data_type(size),
column_name3 data_type(size),
....
);
data_type 参数规定列的[数据类型](http://www.runoob.com/sql/sql-datatypes.html)（例如 varchar、int、decimal、date 等等）。

# 10、SQL约束
约束可以在创建表时规定（通过 CREATE TABLE 语句），或者在表创建之后规定（通过 ALTER TABLE 语句）。
- NOT NULL - 指示某列不能存储 NULL 值。
- UNIQUE - 保证某列的每行必须有唯一的值。
- PRIMARY KEY - NOT NULL 和 UNIQUE 的结合。确保某列（或两个列多个列的结合）有唯一标识，有助于更容易更快速地找到表中的一个特定的记录。
- FOREIGN KEY - 保证一个表中的数据匹配另一个表中的值的参照完整性。
- CHECK - 保证列中的值符合指定的条件。
- DEFAULT - 规定没有给列赋值时的默认值。
```
CREATE TABLE Persons
(
    Id_P int NOT NULL,
    LastName varchar(255) NOT NULL,
    FirstName varchar(255),
    Address varchar(255),
    City varchar(255),
    PRIMARY KEY (Id_P)  //PRIMARY KEY约束
)
CREATE TABLE Personss
(
    Id_P int NOT NULL PRIMARY KEY,   //PRIMARY KEY约束
    LastName varchar(255) NOT NULL,
    FirstName varchar(255),
    Address varchar(255),
    City varchar(255)
)
两种写法在mysql上都能运行。unique关键字也可以这样做。
```
UNIQUE 和 PRIMARY KEY 约束均为列或列集合提供了唯一性的保证。

PRIMARY KEY 约束拥有自动定义的 UNIQUE 约束。

请注意，每个表可以有多个 UNIQUE 约束，但是每个表只能有一个 PRIMARY KEY 约束。

如需命名 UNIQUE 约束，并定义多个列的 UNIQUE 约束，请使用下面的 SQL 语法：
```
CREATE TABLE Persons
(
P_Id int NOT NULL,
LastName varchar(255) NOT NULL,
FirstName varchar(255),
Address varchar(255),
City varchar(255),
CONSTRAINT uc_PersonID UNIQUE (P_Id,LastName)
)
//uc_PersonID是别名，也可以说是索引
```

## ALTER TABLE 时的 SQL UNIQUE 约束
当表已被创建时，如需在 "P_Id" 列创建 UNIQUE 约束，请使用下面的 SQL：

>ALTER TABLE Persons  ADD UNIQUE (P_Id)

如需命名 UNIQUE 约束，并定义多个列的 UNIQUE 约束，请使用下面的 SQL 语法：

> ALTER TABLE Persons  ADD CONSTRAINT uc_PersonID UNIQUE (P_Id,LastName)

如需撤销 UNIQUE 约束，请使用下面的 SQL：

>ALTER TABLE Persons  DROP INDEX uc_PersonID

# 11、SQL PRIMARY KEY 约束
- PRIMARY KEY 约束唯一标识数据库表中的每条记录。
- 主键必须包含唯一的值。
- 主键列不能包含 NULL 值。
- 每个表都应该有一个主键，并且每个表只能有一个主键。

# 12、SQL FOREIGN KEY 约束
- 一个表中的 FOREIGN KEY 指向另一个表中的 PRIMARY KEY。
- FOREIGN KEY 约束用于预防破坏表之间连接的行为。
- FOREIGN KEY 约束也能防止非法数据插入外键列，因为它必须是它指向的那个表中的值之一。

```
CREATE TABLE Orders
(
O_Id int NOT NULL,
OrderNo int NOT NULL,
P_Id int,
PRIMARY KEY (O_Id),
FOREIGN KEY (P_Id) REFERENCES Persons(P_Id)
)

ALTER TABLE Orders  ADD CONSTRAINT fk_PerOrders  FOREIGN KEY (P_Id)  REFERENCES Persons(P_Id)
```

# 13、SQL CHECK 约束
- 如果对单个列定义 CHECK 约束，那么该列只允许特定的值。
- 如果对一个表定义 CHECK 约束，那么此约束会基于行中其他列的值在特定的列中对值进行限制。
```
CREATE TABLE Persons
(
P_Id int NOT NULL,
LastName varchar(255) NOT NULL,
FirstName varchar(255),
Address varchar(255),
City varchar(255),
CHECK (P_Id>0)
)

ALTER TABLE Persons ADD CONSTRAINT chk_Person CHECK (P_Id>0 AND City='Sandnes')

ALTER TABLE Persons  DROP CHECK chk_Person
```

# 14、SQL DEFAULT 约束
DEFAULT 约束用于向列中插入默认值。
如果没有规定其他的值，那么会将默认值添加到所有的新记录。
```
CREATE TABLE Orders
(
O_Id int NOT NULL,
OrderNo int NOT NULL,
P_Id int,
OrderDate date DEFAULT GETDATE()
)

ALTER TABLE Persons  ALTER City SET DEFAULT 'SANDNES'

ALTER TABLE Persons  ALTER City DROP DEFAULT
```

# 15、SQL CREATE INDEX 语句（感觉和as相像）
在`不读取整个表`的情况下，索引使数据库应用程序可以更快地查找数据。

注释：更新一个包含索引的表需要比更新一个没有索引的表花费更多的时间，这是由于索引本身也需要更新。因此，理想的做法是仅仅在常常被搜索的列（以及表）上面创建索引。

CREATE INDEX index_name  ON table_name (column_name)

CREATE UNIQUE INDEX index_name  ON table_name (column_name)

ALTER TABLE table_name DROP INDEX index_name

DROP TABLE table_name

DROP DATABASE database_name

TRUNCATE(把…截短；缩短；使成平面) TABLE table_name  如果我们仅仅需要删除表内的数据，但并不删除表本身

# 16、ALTER TABLE 语句用于在已有的表中添加、删除或修改列。
ALTER TABLE table_name ADD column_name datatype

ALTER TABLE table_name DROP COLUMN column_name

ALTER TABLE table_name MODIFY COLUMN column_name datatype

# 17、SQL AUTO INCREMENT 字段
Auto-increment 会在新记录插入表中时生成一个唯一的数字。我们通常希望在每次插入新记录时，自动地创建主键字段的值。我们可以在表中创建一个 auto-increment 字段。

下面的 SQL 语句把 "Persons" 表中的 "ID" 列定义为 auto-increment 主键字段：
```
CREATE TABLE Persons
(
ID int NOT NULL AUTO_INCREMENT,
LastName varchar(255) NOT NULL,
FirstName varchar(255),
Address varchar(255),
City varchar(255),
PRIMARY KEY (ID)
)
```
MySQL 使用 AUTO_INCREMENT 关键字来执行 auto-increment 任务。
默认地，AUTO_INCREMENT 的开始值是 1，每条新记录递增 1。
要让 AUTO_INCREMENT 序列以其他的值起始，请使用下面的 SQL 语法：
>ALTER TABLE Persons AUTO_INCREMENT=100

要在 "Persons" 表中插入新记录，我们不必为 "ID" 列规定值（会自动添加一个唯一的值）：
INSERT INTO Persons (FirstName,LastName)
VALUES ('Lars','Monsen')

给已经存在的colume添加自增语法：

ALTER TABLE table_name CHANGE column_name column_name data_type(size) constraint_name AUTO_INCREMENT;
比如：

ALTER TABLE student CHANGE id id INT( 11 ) NOT NULL AUTO_INCREMENT;

# 18、SQL 视图（Views）
在 SQL 中，视图是基于 SQL 语句的结果集的可视化的表。
视图包含行和列，就像一个真实的表。视图中的字段就是来自一个或多个数据库中的真实的表中的字段。

视图 "Current Product List" 会从 "Products" 表列出所有正在使用的产品（未停产的产品）。这个视图使用下面的 SQL 创建：

CREATE VIEW [Current Product List] AS SELECT ProductID,ProductName FROM Products WHERE Discontinued=No
我们可以像这样查询上面这个视图：

SELECT * FROM [Current Product List]

>SQL 更新视图
CREATE OR REPLACE VIEW view_name AS SELECT column_name(s) FROM table_name WHERE condition

DROP VIEW view_name

# 19、MySQL Date 函数
下面的表格列出了 MySQL 中最重要的内建日期函数：

函数  描述
NOW()   返回当前的日期和时间
CURDATE()   返回当前的日期
CURTIME()   返回当前的时间
DATE()  提取日期或日期/时间表达式的日期部分
EXTRACT()   返回日期/时间的单独部分
DATE_ADD()  向日期添加指定的时间间隔
DATE_SUB()  从日期减去指定的时间间隔
DATEDIFF()  返回两个日期之间的天数
DATE_FORMAT()   用不同的格式显示日期/时间

# 20、SQL NULL 值
- NULL 值代表遗漏的未知数据。
- 默认地，表的列可以存放 NULL 值。
- NULL 用作未知的或不适用的值的占位符。
- 无法使用比较运算符来测试 NULL 值，比如 =、< 或 <>。我们必须使用 IS NULL 和 IS NOT NULL 操作符。

--如果alexa列为null值，则赋予0，否则，取原值
select id,name,url,ifnull(alexa,0)from websites;
select id,name,url,COALESCE(alexa,0) from websites;

# 21、[SQL 通用数据类型](http://www.runoob.com/sql/sql-datatypes-general.html)
在 MySQL 中，有三种主要的类型：Text（文本）、Number（数字）和 Date/Time（日期/时间）类型。


